<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PFC Caf√©</title>

<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
:root{
  --bg:#f4efe6;
  --card:#fffaf3;
  --border:#e2d7c6;
  --brown:#6b4f3a;
  --brown-dark:#3e2d20;
  --cream:#fff4e1;
  --accent:#c08a5d;
}

*{margin:0;padding:0;box-sizing:border-box;}

body {
  background: url('file:///C:/Users/paoli/Downloads/anime-coffee-shop-illustration.jpg') no-repeat center center fixed;
  background-size: cover;
  color: var(--brown-dark);
  font-family: 'Outfit', sans-serif;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 1rem;
}

body::before{
  content:"";
  position:fixed;
  inset:0;
  background:radial-gradient(circle at 50% 0%, rgba(0,0,0,0.05), transparent 60%);
  pointer-events:none;
}

h1{
  font-family:'Bebas Neue';
  font-size:clamp(2.5rem,6vw,4rem);
  letter-spacing:.08em;
  color:var(--brown-dark);
}

.sub{
  font-size:.8rem;
  letter-spacing:.3em;
  text-transform:uppercase;
  color:#9a8f82;
  margin-bottom:2rem;
}

/* lobby */
#lobby{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:18px;
  padding:2rem;
  width:100%;
  max-width:420px;
  text-align:center;
  box-shadow:0 10px 30px rgba(0,0,0,0.05);
}

.lobby-title{
  font-family:'Bebas Neue';
  font-size:1.6rem;
  margin-bottom:1.4rem;
  color:var(--brown);
}

.room-input{
  width:100%;
  padding:.9rem;
  border-radius:10px;
  border:1px solid var(--border);
  background:var(--cream);
  text-align:center;
  font-size:1rem;
  margin-bottom:1rem;
}

.btn-main{
  width:100%;
  padding:.9rem;
  border:none;
  border-radius:10px;
  font-family:'Bebas Neue';
  font-size:1.1rem;
  letter-spacing:.1em;
  cursor:pointer;
  margin-bottom:.7rem;
  background:var(--brown);
  color:#fff;
  transition:.2s;
}

.btn-main:hover{background:var(--brown-dark);}

.or-sep{
  color:#b7a99a;
  font-size:.75rem;
  margin:.4rem 0 1rem;
}

/* GAME */
#game{display:none;width:100%;max-width:860px;}

.room-info{
  text-align:center;
  margin-bottom:1.5rem;
  display:flex;
  gap:1rem;
  justify-content:center;
  flex-wrap:wrap;
}

.room-code{
  background:var(--cream);
  border:1px solid var(--border);
  padding:.3rem 1rem;
  border-radius:6px;
  font-family:'Bebas Neue';
  letter-spacing:.2em;
  color:var(--brown);
  cursor:pointer;
}

.status-pill{
  background:var(--cream);
  border:1px solid var(--border);
  border-radius:40px;
  padding:.3rem .9rem;
  font-size:.75rem;
  color:#9a8f82;
}

.status-pill.online{
  color:var(--brown);
  border-color:var(--brown);
}

.arena{
  display:grid;
  grid-template-columns:1fr auto 1fr;
  gap:1rem;
}

.panel{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:16px;
  padding:1.3rem;
}

.pname{
  font-family:'Bebas Neue';
  letter-spacing:.08em;
  color:var(--brown);
}

.pscore{
  font-size:2.5rem;
  font-weight:700;
  color:var(--brown-dark);
}

.cbtn{
  background:var(--cream);
  border:1px solid var(--border);
  border-radius:8px;
  padding:.7rem;
  cursor:pointer;
  transition:.15s;
  width:100%;
}

.cbtn:hover{background:#f0e6d8;}

.center{
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:.6rem;
}

.vs{
  font-family:'Bebas Neue';
  font-size:1.6rem;
  color:#b8a998;
}

.rem{font-size:2.5rem;opacity:0;transition:.3s;}
.rem.show{opacity:1;}

.rmsg{
  font-family:'Bebas Neue';
  color:var(--accent);
  letter-spacing:.08em;
  min-height:1.5rem;
}

.btn-leave{
  background:transparent;
  border:1px solid var(--border);
  padding:.4rem 1rem;
  border-radius:30px;
  font-size:.75rem;
  cursor:pointer;
}

.notif{
  position:fixed;
  top:1.5rem;
  left:50%;
  transform:translateX(-50%);
  background:var(--card);
  border:1px solid var(--border);
  border-radius:40px;
  padding:.5rem 1.2rem;
  color:var(--brown);
  opacity:0;
  transition:.3s;
}
.notif.show{opacity:1;}
</style>
</head>

<body>

<h1>PFC CAF√â</h1>
<p class="sub">Pierre ¬∑ Feuille ¬∑ Ciseaux</p>

<div id="notif" class="notif"></div>

<div id="lobby">
  <div class="lobby-title">‚òï Table libre</div>
  <button class="btn-main" onclick="createRoom()">Cr√©er une table</button>
  <div class="or-sep">ou rejoindre</div>
  <input class="room-input" id="codeInput" maxlength="6" placeholder="CODE" />
  <button class="btn-main" onclick="joinRoom()">Rejoindre</button>
</div>

<div id="game">
  <div class="room-info">
    <span>Table :</span>
    <span class="room-code" id="roomCodeDisplay">----</span>
    <span class="status-pill" id="connStatus">En attente</span>
  </div>

  <div class="arena">

    <div class="panel" id="myPanel">
      <div class="pname">Vous</div>
      <div class="pscore" id="myScore">0</div>
      <div id="myChoices">
        <button class="cbtn" onclick="pickChoice('pierre')">ü™® Pierre</button>
        <button class="cbtn" onclick="pickChoice('feuille')">üìÑ Feuille</button>
        <button class="cbtn" onclick="pickChoice('ciseaux')">‚úÇÔ∏è Ciseaux</button>
      </div>
    </div>

    <div class="center">
      <div class="vs">VS</div>
      <div>
        <span class="rem" id="remMe"></span>
        ‚ö°
        <span class="rem" id="remOpp"></span>
      </div>
      <div class="rmsg" id="rmsg"></div>
      <button class="btn-leave" onclick="leaveGame()">Quitter</button>
    </div>

    <div class="panel">
      <div class="pname">Adversaire</div>
      <div class="pscore" id="oppScore">0</div>
    </div>

  </div>
</div>

<script>
const SUPABASE_URL='https://mkyrhafbsmhyktkjjeoi.supabase.co';
const SUPABASE_KEY='sb_publishable_chgNcjaLvZOho5tezPbA8A_Yoq1PyqF';
const sb=supabase.createClient(SUPABASE_URL,SUPABASE_KEY);

let roomId=null,myRole=null,myChoice=null,realtimeSub=null;

function notif(msg){
 const el=document.getElementById('notif');
 el.textContent=msg;
 el.classList.add('show');
 setTimeout(()=>el.classList.remove('show'),2000);
}

function genCode(){return Math.random().toString(36).substring(2,7).toUpperCase();}

async function createRoom(){
 const code=genCode();
 const state={p1:true,p2:false,p1choice:null,p2choice:null,scores:{p1:0,p2:0}};
 await sb.from('rooms').insert({id:code,state});
 roomId=code;myRole='p1';
 startGame(state);
}

async function joinRoom(){
 const code=document.getElementById('codeInput').value.trim().toUpperCase();
 const {data}=await sb.from('rooms').select('state').eq('id',code).single();
 if(!data){notif("introuvable");return;}
 roomId=code;myRole='p2';
 data.state.p2=true;
 await sb.from('rooms').update({state:data.state}).eq('id',code);
 startGame(data.state);
}

function startGame(state){
 document.getElementById('lobby').style.display='none';
 document.getElementById('game').style.display='block';
 document.getElementById('roomCodeDisplay').textContent=roomId;
 subscribe();
}

function subscribe(){
 realtimeSub=sb.channel('room-'+roomId)
 .on('postgres_changes',{event:'UPDATE',schema:'public',table:'rooms',filter:'id=eq.'+roomId},
 payload=>updateUI(payload.new.state))
 .subscribe();
}

function updateUI(state){
 const opp=myRole==='p1'?'p2':'p1';
 document.getElementById('myScore').textContent=state.scores[myRole];
 document.getElementById('oppScore').textContent=state.scores[opp];

 if(state.p1choice&&state.p2choice) showResult(state);
}

async function pickChoice(c){
 if(myChoice) return;
 myChoice=c;
 const {data}=await sb.from('rooms').select('state').eq('id',roomId).single();
 const state=data.state;
 state[myRole+'choice']=c;

 if(state.p1choice&&state.p2choice) compute(state);

 await sb.from('rooms').update({state}).eq('id',roomId);
}

function compute(state){
 const c1=state.p1choice,c2=state.p2choice;
 let w='draw';
 if(c1!==c2){
 if((c1==='pierre'&&c2==='ciseaux')||(c1==='feuille'&&c2==='pierre')||(c1==='ciseaux'&&c2==='feuille')) w='p1';
 else w='p2';
 }
 if(w!=='draw') state.scores[w]++;
 state.result={w,c1,c2};
}

function showResult(state){
 const opp=myRole==='p1'?'p2':'p1';
 const myC=state[myRole+'choice'];
 const oppC=state[opp+'choice'];

 document.getElementById('remMe').textContent=myC==='pierre'?'ü™®':myC==='feuille'?'üìÑ':'‚úÇÔ∏è';
 document.getElementById('remOpp').textContent=oppC==='pierre'?'ü™®':oppC==='feuille'?'üìÑ':'‚úÇÔ∏è';

 document.getElementById('remMe').classList.add('show');
 document.getElementById('remOpp').classList.add('show');

 setTimeout(resetRound,2000);
}

async function resetRound(){
 myChoice=null;
 const {data}=await sb.from('rooms').select('state').eq('id',roomId).single();
 const state=data.state;
 state.p1choice=null;
 state.p2choice=null;
 await sb.from('rooms').update({state}).eq('id',roomId);

 document.getElementById('remMe').classList.remove('show');
 document.getElementById('remOpp').classList.remove('show');
}

function leaveGame(){location.reload();}
</script>

</body>
</html>